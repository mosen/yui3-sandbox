YUI.add("gallery-dp-editable",function(c){var g=c.Lang,d=c.ClassNameManager.getClassName,a=d("gallery","dp","editable"),b=a+"-form",i=a+"-input",f=a+"-submit",l=a+"-cancel",e=a+"-placeholder",h=a+"-field",k=a+"-field-saving";function j(){this.publish("save",{defaultFn:this._defFnSave});this.publish("cancel",{defaultFn:this._defFnCancel});this.after("savingChange",this._uiSetSaving,this);this.after("editingChange",this._uiSetEditing,this);}c.mix(j,{NAME:"editableBase",ATTRS:{strings:{value:{tooltip:"Click to edit...",cancel:"Cancel",submit:"OK",indicator:"Saving...",placeholder:"Click to edit..."}},targetnode:{value:null},editingnode:{value:null},event:{value:"click"},prevContent:{value:null},type:{value:"text",validator:"_validateAttrType"},rows:{value:null},cols:{value:null},submitto:{value:null},method:{value:"POST"},loadfrom:{value:null},editing:{value:false},saving:{value:false},select:{value:false},inputWidth:{value:"auto"},inputHeight:{value:"auto"},onblur:{value:"cancel"},delegate:{value:null}}});j.prototype={destructor:function(){this.get("targetnode").detach(this.get("event"));},_bindEditableBase:function(){if(null===this.get("delegate")){this.get("targetnode").on(this.get("event"),c.bind(this._onClick,this));}else{this.get("targetnode").delegate(this.get("event"),this._onClick,this.get("delegate"),this);}},_syncEditableBase:function(){var n;if(null===this.get("delegate")){n=this.get("editingnode");}else{n=this.get("targetnode").all(this.get("delegate"));}n.set("title",this.get("strings.tooltip"));n.addClass(h);if(this.get("targetnode").get("innerHTML").length===0){this.get("targetnode").append(this._renderPlaceHolder());}},_renderPlaceHolder:function(){return c.Node.create(c.substitute(this.TEMPLATE_PLACEHOLDER,{className:e,text:this.get("strings.placeholder")}));},_validateAttrType:function(n){return("textarea"==n||"text"==n||"select"==n)?true:false;},_onClick:function(o){var n=this.get("editingnode");o.halt();if(this.get("editing")===true&&n!==null&&n.contains(o.target)){return false;}if(this.get("editing")===true&&o.currentTarget.get("id")!=n.get("id")){this.save();}this.edit(o.currentTarget);},_onClickCancel:function(n){n.stopPropagation();this.discard();},_onClickSave:function(n){n.stopPropagation();this.save();},_onKey:function(n){n.halt();if(n.keyCode==27){this.discard();}else{if(n.keyCode==13){this.save();}}},_uiSetSaving:function(n){if(null!=this.get("editingnode")){if(true===this.get("saving")){this.get("editingnode").addClass(k);}else{this.get("editingnode").removeClass(k);}}},_uiSetEditing:function(r){if(true===this.get("editing")){if(true===r.prevVal){return false;}var p=this._renderForm(),n=this.get("editingnode"),s=this.get("editingnode").one("."+e),q,o=this.get("loadfrom");this.set("prevContent",n.get("innerHTML"));if(s){s.remove();}if(c.Lang.isFunction(o)){q=o(n);}else{if(c.Lang.isString(o)){}else{if(c.Lang.isNull(o)){q=n.get("textContent");}}}n.set("innerHTML","");n.append(p);this._input.set("value",q);this._input.focus();if(true===this.get("select")){this._input.select();}}else{}},_defFnSave:function(n){},_defFnCancel:function(){},_renderForm:function(){var o=this.get("type"),r=c.Node.create(c.substitute(this.TEMPLATE_FORM,{className:b})),n,q,s=this.get("inputWidth"),p=this.get("inputHeight");switch(o){case"textarea":n=c.Node.create(c.substitute(this.TEMPLATE_INPUT_TEXTAREA,{className:i}));if(this.get("rows")!==null){n.setAttribute("rows",this.get("rows"));}if(this.get("cols")!==null){n.setAttribute("cols",this.get("cols"));}break;case"select":n=c.Node.create(c.substitute(this.TEMPLATE_INPUT_SELECT,{className:i}));break;case"text":default:n=c.Node.create(c.substitute(this.TEMPLATE_INPUT_TEXT,{className:i}));break;}if(s!=="auto"){n.setStyle("width",s);}if(p!=="auto"){n.setStyle("height",p);}this._input=n;this._input.on("key",this.save,"enter",this);this._input.on("key",this.discard,"esc",this);r.append(this._input);q=c.Node.create(c.substitute(this.TEMPLATE_BUTTONS,{classNameSubmit:f,classNameCancel:l,labelSubmit:this.get("strings.submit"),labelCancel:this.get("strings.cancel")}));q.one("."+l).on("click",this._onClickCancel,this);q.one("."+f).on("click",this._onClickSave,this);r.append(q);return r;},edit:function(n){this.set("editingnode",n);this.set("editing",true);},save:function(){var o=this.get("editingnode"),n=this.get("submitto");this.set("saving",true);if(c.Lang.isFunction(n)){n(o,c.bind(this.saveComplete,this));this.set("editing",false);}else{if(c.Lang.isString(n)){var p=this._input.get("value");this.get("editingnode").set("innerHTML","");this.get("editingnode").append(p);c.io(c.substitute(n,{value:this._input.get("value")}),{on:{start:function(s,r,q){this.set("saving",true);},success:function(s,r,q){this.set("saving",false);this.set("editing",false);this.fire("save",r);},failure:function(s,r,q){this.set("saving",false);this.set("editing",false);this.get("editingnode").set("innerHTML",this.get("prevContent"));}},context:this,arguments:{node:o}});}else{if(null===n){var p=this._input.get("value");this.get("editingnode").set("innerHTML","");this.get("editingnode").append(p);this.set("editing",false);this.set("saving",false);this.set("prevContent",null);this.set("editingnode",null);}}}},saveComplete:function(){this.set("saving",false);this.set("prevContent",null);this.set("editingnode",null);},requestSave:function(q,p){var n=this.get("submitto"),o=this.get("fnSubmitValues")!==null?this.get("fnSubmitValues")(this.get("editingnode"),q):{value:q};if(c.Lang.isString(n)){c.io(c.substitute(n,o),{on:{start:this._uiSetSaving,success:this._uiSetSaveSuccess,failure:this._uiSetSaveFailure},context:this,arguments:{value:q,node:p}});}else{if(c.Lang.isFunction(n)){n();}}},discard:function(){var n=this.get("editingnode");n.set("innerHTML",this.get("prevContent"));this.set("prevContent",null);this.set("editingnode",null);this.set("editing",false);this.fire("cancel");},clear:function(){var o=this.get("editingnode"),n=this.get("targetnode");n.set("innerHTML","");n.append(this._renderPlaceHolder());
this.set("prevContent",null);this.set("editing",false);},TEMPLATE_FORM:'<form class="{className}"></form>',TEMPLATE_INPUT_TEXT:'<input type="text" class="{className}"></input>',TEMPLATE_INPUT_TEXTAREA:'<textarea class="{className}"></textarea>',TEMPLATE_INPUT_SELECT:'<select class="{className}"></select>',TEMPLATE_BUTTONS:'<input type="button" value="{labelCancel}" class="{classNameCancel}"></input><input type="button" value="{labelSubmit}" class="{classNameSubmit}"></input>',TEMPLATE_PLACEHOLDER:'<span class="{className}">{text}</span>',_input:null};c.namespace("DP").EditableBase=j;var m=c.Base.create("editablePlugin",c.Plugin.Base,[c.DP.EditableBase],{initializer:function(n){this.set("targetnode",n.host);if(!n.delegate){this.set("editingnode",n.host);}this._bindEditableBase();this._syncEditableBase();}},{NS:"editable",NAME:"editable"});c.namespace("DP").EditablePlugin=m;},"@VERSION@",{requires:["node","base","event","plugin","io"]});