YUI.add("gallery-dp-editable",function(c){var g=c.Lang,d=c.ClassNameManager.getClassName,a=d("gallery","dp","editable"),b=a+"-form",i=a+"-input",f=a+"-submit",l=a+"-cancel",e=a+"-placeholder",h=a+"-field",k=a+"-field-saving";function j(){this.publish("save",{defaultFn:this._defFnSave});this.publish("cancel",{defaultFn:this._defFnCancel});this.after("savingChange",this._uiSetSaving,this);this.after("editingChange",this._uiSetEditing,this);}c.mix(j,{NAME:"editableBase",ATTRS:{strings:{value:{tooltip:"Click to edit...",cancel:"Cancel",submit:"OK",indicator:"Saving...",placeholder:"Click to edit..."}},targetnode:{value:null},editingnode:{value:null},event:{value:"click"},prevContent:{value:null},type:{value:"text",validator:"_validateAttrType"},rows:{value:null},cols:{value:null},submitto:{value:null},method:{value:"POST"},loadfrom:{value:null},editing:{value:false},saving:{value:true},select:{value:false},inputWidth:{value:"auto"},inputHeight:{value:"auto"},onblur:{value:"cancel"},delegate:{value:null}}});j.prototype={destructor:function(){this.get("targetnode").detach(this.get("event"));},_bindEditableBase:function(){if(null==this.get("delegate")){this.get("targetnode").on(this.get("event"),c.bind(this._onClick,this));}else{this.get("targetnode").delegate(this.get("event"),this._onClick,this.get("delegate"),this);}},_syncEditableBase:function(){var m;if(null==this.get("delegate")){m=this.get("editingnode");}else{m=this.get("targetnode").all(this.get("delegate"));}m.set("title",this.get("strings.tooltip"));m.addClass(h);if(this.get("targetnode").get("innerHTML").length==0){this.get("targetnode").append(this._renderPlaceHolder());}},_renderPlaceHolder:function(){return c.Node.create(c.substitute(this.TEMPLATE_PLACEHOLDER,{className:e,text:this.get("strings.placeholder")}));},_validateAttrType:function(m){return("textarea"==m||"text"==m||"select"==m)?true:false;},_onClick:function(m){m.halt();if(this._input==m.target){return false;}if(this.get("editingnode")!==null&&this.get("editingnode")!==m.currentTarget){this.save();}this.set("editingnode",m.currentTarget);this.set("editing",true);},_onClickCancel:function(m){m.stopPropagation();this.discard();},_onClickSave:function(m){m.stopPropagation();this.save();},_onKey:function(m){m.halt();if(m.keyCode==27){this.discard();}else{if(m.keyCode=13){this.save();}}},_uiSetSaving:function(m){if(null!=this.get("editingnode")){if(true==this.get("saving")){this.get("editingnode").addClass(k);}else{this.get("editingnode").removeClass(k);}}},_uiSetEditing:function(q){if(true==this.get("editing")){if(true==q.prevVal){return false;}var o=this._renderForm(),m=this.get("editingnode"),r=this.get("editingnode").one("."+e),p,n=this.get("loadfrom");this.set("prevContent",m.get("innerHTML"));if(r){r.remove();}if(c.Lang.isFunction(n)){p=n(m);}else{if(c.Lang.isString(n)){}else{if(c.Lang.isNull(n)){p=m.get("textContent");}}}m.set("innerHTML","");m.append(o);this._input.set("value",p);this._input.focus();if(true==this.get("select")){this._input.select();}}else{}},_defFnSave:function(m){},_defFnCancel:function(){},_renderForm:function(){var n=this.get("type"),q=c.Node.create(c.substitute(this.TEMPLATE_FORM,{className:b})),m,p,r=this.get("inputWidth"),o=this.get("inputHeight");switch(n){case"textarea":m=c.Node.create(c.substitute(this.TEMPLATE_INPUT_TEXTAREA,{className:i}));if(this.get("rows")!==null){m.setAttribute("rows",this.get("rows"));}if(this.get("cols")!==null){m.setAttribute("cols",this.get("cols"));}break;case"select":m=c.Node.create(c.substitute(this.TEMPLATE_INPUT_SELECT,{className:i}));break;case"text":default:m=c.Node.create(c.substitute(this.TEMPLATE_INPUT_TEXT,{className:i}));break;}if(r!=="auto"){m.setStyle("width",r);}if(o!=="auto"){m.setStyle("height",o);}this._input=m;this._input.on("key",this._onKey,"down:13",this);this._input.on("key",this._onKey,"down:27",this);q.append(this._input);p=c.Node.create(c.substitute(this.TEMPLATE_BUTTONS,{classNameSubmit:f,classNameCancel:l,labelSubmit:this.get("strings.submit"),labelCancel:this.get("strings.cancel")}));p.one("."+l).on("click",this._onClickCancel,this);p.one("."+f).on("click",this._onClickSave,this);q.append(p);return q;},save:function(){var n=this.get("editingnode"),m=this.get("submitto");this.set("saving",true);if(c.Lang.isFunction(m)){m(n);}else{if(c.Lang.isString(m)){var o=this._input.get("value");this.get("editingnode").set("innerHTML","");this.get("editingnode").append(o);c.io(c.substitute(m,{value:this._input.get("value")}),{on:{start:function(r,q,p){this.set("saving",true);},success:function(r,q,p){this.set("saving",false);this.fire("save",q);},failure:function(r,q,p){this.set("saving",false);this.get("editingnode").set("innerHTML",this.get("prevContent"));}},context:this,arguments:{node:n}});}else{if(null==m){var o=this._input.get("value");this.get("editingnode").set("innerHTML","");this.get("editingnode").append(o);this.set("prevContent",null);this.set("editingnode",null);this.set("editing",false);this.set("saving",false);}}}},requestSave:function(p,o){var m=this.get("submitto"),n=this.get("fnSubmitValues")!==null?this.get("fnSubmitValues")(this.get("editingnode"),p):{value:p};if(c.Lang.isString(m)){c.io(c.substitute(m,n),{on:{start:this._uiSetSaving,success:this._uiSetSaveSuccess,failure:this._uiSetSaveFailure},context:this,arguments:{value:p,node:o}});}else{if(c.Lang.isFunction(m)){m();}}},discard:function(){var m=this.get("editingnode");m.set("innerHTML",this.get("prevContent"));this.set("prevContent",null);this.set("editingnode",null);this.set("editing",false);this.fire("cancel");},clear:function(){var n=this.get("editingnode"),m=this.get("targetnode");m.set("innerHTML","");m.append(this._renderPlaceHolder());this.set("prevContent",null);this.set("editing",false);},TEMPLATE_FORM:'<form class="{className}"></form>',TEMPLATE_INPUT_TEXT:'<input type="text" class="{className}"></input>',TEMPLATE_INPUT_TEXTAREA:'<textarea class="{className}"></textarea>',TEMPLATE_INPUT_SELECT:'<select class="{className}"></select>',TEMPLATE_BUTTONS:'<input type="button" value="{labelCancel}" class="{classNameCancel}"></input><input type="button" value="{labelSubmit}" class="{classNameSubmit}"></input>',TEMPLATE_PLACEHOLDER:'<span class="{className}">{text}</span>',_input:null};
c.namespace("DP").EditableBase=j;EditablePlugin=c.Base.create("editablePlugin",c.Plugin.Base,[c.DP.EditableBase],{initializer:function(m){this.set("targetnode",m.host);if(!m.delegate){this.set("editingnode",m.host);}this._bindEditableBase();this._syncEditableBase();}},{NS:"editable",NAME:"editable"});c.namespace("DP").EditablePlugin=EditablePlugin;},"@VERSION@",{requires:["base","event","plugin","io"]});