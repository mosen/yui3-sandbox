YUI.add("gallery-dp-editable",function(c){var g=c.Lang,d=c.ClassNameManager.getClassName,a=d("gallery","dp","editable"),b=a+"-form",i=a+"-input",f=a+"-submit",l=a+"-cancel",e=a+"-placeholder",h=a+"-field",k=a+"-field-saving";function j(){this.publish("afterSave",{defaultFn:this._defFnAfterSave});this.publish("afterCancel",{defaultFn:this._defFnAfterCancel});}c.mix(j,{NAME:"editableBase",ATTRS:{strings:{value:{tooltip:"Click to edit...",cancel:"Cancel",submit:"OK",indicator:"Saving...",placeholder:"Click to edit..."}},targetnode:{value:null},editingnode:{value:null},event:{value:"click"},prevContent:{value:null},type:{value:"text",validator:"_validateAttrType"},rows:{value:null},cols:{value:null},submitto:{value:null},fnSubmitValues:{value:null},method:{value:"POST"},loadfrom:{value:null},fnNodeToObject:{value:function(m){return{value:m.get("textContent")};}},fnObjectToNode:{value:function(m){return m.get("value");}},editing:{value:false},select:{value:false},inputWidth:{value:"auto"},inputHeight:{value:"auto"},onblur:{value:"cancel"},delegate:{value:null}}});j.prototype={destructor:function(){this.get("targetnode").detach(this.get("event"));},_bindEditableBase:function(){if(null==this.get("delegate")){this.get("targetnode").on(this.get("event"),c.bind(this._onClick,this));}else{this.get("targetnode").delegate(this.get("event"),this._onClick,this.get("delegate"),this);}},_syncEditableBase:function(){var m;if(null==this.get("delegate")){m=this.get("editingnode");}else{m=this.get("targetnode").all(this.get("delegate"));}m.set("title",this.get("strings.tooltip"));m.addClass(h);},_validateAttrType:function(m){return("textarea"==m||"text"==m||"select"==m)?true:false;},_onClick:function(m){m.halt();if(this._input==m.target){return false;}if(this.get("editingnode")!==null&&this.get("editingnode")!==m.currentTarget){this.save();}this.set("editingnode",m.currentTarget);this.startEditor();},_onClickCancel:function(m){m.stopPropagation();this.discard();},_onClickSave:function(m){m.stopPropagation();this.save();},_defFnAfterSave:function(m){this.requestSave(m.value,m.node);},_defFnAfterCancel:function(){},startEditor:function(){if(true==this.get("editing")){return false;}var p=this._renderForm(),q=this.get("inputWidth"),o=this.get("inputHeight"),n=this.get("editingnode"),r,m=this.get("loadfrom");this.set("prevContent",n.get("innerHTML"));r=this.get("fnNodeToObject")(n);n.set("innerHTML","");n.append(p);this._input.set("value",r);this._input.focus();if(true==this.get("select")){this._input.select();}this.set("editing",true);},_renderForm:function(){var n=this.get("type"),q=c.Node.create(c.substitute(this.TEMPLATE_FORM,{className:b})),m,p,r=this.get("inputWidth"),o=this.get("inputHeight");switch(n){case"textarea":m=c.Node.create(c.substitute(this.TEMPLATE_INPUT_TEXTAREA,{className:i}));if(this.get("rows")!==null){m.setAttribute("rows",this.get("rows"));}if(this.get("cols")!==null){m.setAttribute("cols",this.get("cols"));}break;case"select":m=c.Node.create(c.substitute(this.TEMPLATE_INPUT_SELECT,{className:i}));break;case"text":default:m=c.Node.create(c.substitute(this.TEMPLATE_INPUT_TEXT,{className:i}));break;}if(r!=="auto"){m.setStyle("width",r);}if(o!=="auto"){m.setStyle("height",o);}this._input=m;this._input.on("key",this._onKey,"down:13",this);this._input.on("key",this._onKey,"down:27",this);q.append(this._input);p=c.Node.create(c.substitute(this.TEMPLATE_BUTTONS,{classNameSubmit:f,classNameCancel:l,labelSubmit:this.get("strings.submit"),labelCancel:this.get("strings.cancel")}));p.one("."+l).on("click",this._onClickCancel,this);p.one("."+f).on("click",this._onClickSave,this);q.append(p);return q;},save:function(){var n=this.get("editingnode"),m=this._input.get("value");n.set("innerHTML","");n.append(this.get("fnObjectToNode")(this._input));this.set("prevContent",null);this.set("editingnode",null);this.set("editing",false);this.fire("afterSave",{value:m,node:n});},requestSave:function(p,o){var m=this.get("submitto"),n=this.get("fnSubmitValues")!==null?this.get("fnSubmitValues")(this.get("editingnode"),p):{value:p};if(c.Lang.isString(m)){c.io(c.substitute(m,n),{on:{start:this._uiSetSaving,success:this._uiSetSaveSuccess,failure:this._uiSetSaveFailure},context:this,arguments:{value:p,node:o}});}else{if(c.Lang.isFunction(m)){m();}}},discard:function(){var m=this.get("editingnode");m.set("innerHTML",this.get("prevContent"));this.set("prevContent",null);this.set("editingnode",null);this.set("editing",false);this.fire("afterCancel");},_onKey:function(m){m.halt();if(m.keyCode==27){this.discard();}else{if(m.keyCode=13){this.save();}}},_uiSetSaving:function(n,m){console.dir(m);m.node.addClass(k);},_uiSetSaveSuccess:function(n,p,m){m.node.removeClass(k);},TEMPLATE_FORM:'<form class="{className}"></form>',TEMPLATE_INPUT_TEXT:'<input type="text" class="{className}"></input>',TEMPLATE_INPUT_TEXTAREA:'<textarea class="{className}"></textarea>',TEMPLATE_INPUT_SELECT:'<select class="{className}"></select>',TEMPLATE_BUTTONS:'<input type="button" value="{labelCancel}" class="{classNameCancel}"></input><input type="button" value="{labelSubmit}" class="{classNameSubmit}"></input>',TEMPLATE_PLACEHOLDER:'<span class="{className}">{text}</span>',_input:null};c.namespace("DP").EditableBase=j;EditablePlugin=c.Base.create("editablePlugin",c.Plugin.Base,[c.DP.EditableBase],{initializer:function(m){this.set("targetnode",m.host);if(!m.delegate){this.set("editingnode",m.host);}this._bindEditableBase();this._syncEditableBase();}},{NS:"editable",NAME:"editable"});c.namespace("DP").EditablePlugin=EditablePlugin;},"@VERSION@",{requires:["base","plugin","io"]});