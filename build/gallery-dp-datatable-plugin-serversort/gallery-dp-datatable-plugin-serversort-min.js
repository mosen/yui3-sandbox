YUI.add("gallery-dp-datatable-plugin-serversort",function(a){var h=a.Lang,i=a.ClassNameManager.getClassName,j="datatable",l="column",d="asc",g="desc",f=1001,b=1002,e=1000,c={1000:"NONE",1001:"ASC",1002:"DESC"},k='<a class="{link_class}" title="{link_title}" href="{link_href}">{value}</a>';a.namespace("DP").DataTableServerSort=a.Base.create("gallery-dp-datatable-plugin-serversort",a.Plugin.Base,[],{initializer:function(n){var o=this.get("host"),m=o.datasource;this.beforeHostMethod("_createTheadThNode",this._beforeCreateTheadThNode,this);this.beforeHostMethod("_attachTheadThNode",this._beforeAttachTheadThNode,this);this.beforeHostMethod("_attachTbodyTdNode",this._beforeAttachTbodyTdNode,this);o.delegate("click",a.bind(this._handleHeaderClick,this),"th");this.publish("sort",{defaultFn:this._uiSetSort});},destructor:function(){},_beforeCreateTheadThNode:function(m){if(m.column.get("sortable")){m.value=a.substitute(this.get("template"),{link_class:m.link_class||"",link_title:m.column.get("title")||m.column.get("key"),link_href:"#",value:m.value});}},_beforeAttachTheadThNode:function(r){var q=this.get("lastSortedBy"),p=q&&q.key,m=q&&q.dir,n=q&&q.notdir;if(r.column.get("sortable")){r.th.addClass(i(j,"sortable"));}if(p&&(p===r.column.get("key"))){r.th.replaceClass(i(j,n),i(j,m));}},_beforeAttachTbodyTdNode:function(r){var q=this.get("lastSortedBy"),p=q&&q.key,m=q&&q.dir,n=q&&q.notdir;if(r.column.get("sortable")){r.td.addClass(i(j,"sortable"));}if(p&&(p===r.column.get("key"))){r.td.replaceClass(i(j,n),i(j,m));}},_handleHeaderClick:function(o){o.halt();var n=this.get("host"),m=n.get("columnset").idHash[o.currentTarget.get("id")];if(m.get("sortable")){this.sort(m);}},sort:function(n,m){var p=this.get("sorting"),o=n.get("id"),q=p[o];if(m!==undefined){p[n.get("id")]=m;}else{if(q===undefined||q===e){p[o]=f;}else{if(q===f){p[o]=b;}else{if(q===b){delete p[o];}}}}this.fire("sort",{column:n,direction:p[o]});},_uiSetSort:function(n){var m=n.column.thNode;switch(n.direction){case f:m.removeClass(i(j,g));m.addClass(i(j,d));break;case b:m.removeClass(i(j,d));m.addClass(i(j,g));break;default:m.removeClass(i(j,g));m.removeClass(i(j,d));}},getQueryParameters:function(){var n=this.get("sorting"),o=[],m;for(key in n){m=this.get("host").get("columnset").idHash[key];o.push("sort["+m.get("key")+"]="+c[n[key]]);}return o;}},{NS:"sort",ATTRS:{sorting:{value:[]},template:{value:k}}});},"@VERSION@",{requires:["datatable","datatable-datasource"]});