YUI.add("gallery-datatable-ml-dd",function(a){function i(){i.superclass.constructor.apply(this,arguments)}var b=a.ClassNameManager.getClassName,c="datatable",d=b(c,"tbody","dragging"),e=b(c,"row","droptarget"),f=b(c,"droptarget"),g=b(c,"droptarget","over"),h='<tr class="{className}"><td colspan="{colSpan}"><div class="{divClassName}">&nbsp;</div></td></tr>';a.mix(i,{NS:"dd",NAME:"datatableMlDd",ATTRS:{}}),a.extend(i,a.Plugin.Base,{initializer:function(b){this.publish("rowDropped",{defaultFn:a.bind(this._defFnRowDropped,this)}),this.publish("reorder"),this._initDelegates(),this.get("host").after("modelsRendered",this._syncDelegates,this),this.get("host").after("render",this._bindDelegates,this)},destructor:function(){this._delegate.destroy()},_initDelegates:function(){var b=this.get("host").get("contentBox");this._delegate=new a.DD.Delegate({container:b,nodes:".yui3-datatable-data tr",target:!0,dragConfig:{plugins:[{fn:a.Plugin.DDProxy,cfg:{moveOnEnd:!1}},{fn:a.Plugin.DDConstrained,cfg:{constrain2node:b}}]}})},_bindDelegates:function(){this._delegate.on("drag:start",this._uiSetDragging,this),this._delegate.on("drag:end",this._uiSetNotDragging,this),this._delegate.on("drag:over",this._uiSetOver,this),this._delegate.on("drag:exit",this._uiSetOut,this),this._delegate.on("drag:drophit",this._updateOrder,this)},_syncDelegates:function(){this._delegate&&this._delegate.syncTargets()},_updateOrder:function(a){a.drop.get("node").insert(a.drag.get("node"),"before"),a.drop.get("node").removeClass(g),this.fire("rowDropped",{drag:a.drag,drop:a.drop,source:a.drag.get("node"),dest:a.drop.get("node")})},_uiSetOver:function(a){a.drop.get("node").addClass(g)},_uiSetOut:function(a){a.drop.get("node").removeClass(g)},_uiSetDragging:function(a){var b=this.get("host").get("contentBox").one("tbody.yui3-datatable-data");b.addClass(d)},_uiSetNotDragging:function(a){var b=this.get("host").get("contentBox").one("tbody.yui3-datatable-data");b.removeClass(d)},_defFnRowDropped:function(a){var b=this.get("host").get("models"),c=this.get("host").get("contentBox").one("tbody.yui3-datatable-data"),d=c.all("tr"),e=0;d.each(function(a){b.getByClientId(a.get("id")).set("order",e),e++}),this.fire("reorder")}}),a.namespace("DP").DatatableMlDd=i},"1.0.0",{requires:["gallery-datatable-ml","dd","dd-drag","dd-proxy","dd-delegate"]})