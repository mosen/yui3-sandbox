YUI.add("gallery-dp-datalist-plugin-editing",function(d){var b=d.Node,c=d.ClassNameManager.getClassName;function a(e){a.superclass.constructor.apply(this,arguments);}d.mix(a,{NS:"editing",NAME:"datalistEditing",ATTRS:{uriCreate:{value:null},uriEdit:{value:null},fnGetValue:{value:null,validator:d.Lang.isFunction},strings:{value:{add:"Add an item"}}}});d.extend(a,d.Plugin.Base,{initializer:function(e){this.afterHostEvent("render",this._renderEditingTools);this.afterHostMethod("_renderItems",this._repositionEditingTools);this.publish("add",{defaultFn:this._defFnAdd});},destructor:function(){},_renderEditingTools:function(){var g=this.get("host").get("contentBox"),f=d.Node.create(d.substitute(this.ITEM_ADD_TEMPLATE,{className:this.get("host").getClassName("add"),label:this.get("strings.add"),wrapperClassName:this.get("host").getClassName("add","wrapper"),id:d.guid()})),h=f.one("span"),e=this.get("uriEdit");this._phlistitem=f;g.append(f);h.plug(d.DP.EditablePlugin,{submitto:this.get("uriCreate"),loadfrom:function(i){return"";}});h.editable.on("save",d.bind(this._newItemAdded,this));this._placeholder=h;g.plug(d.DP.EditablePlugin,{delegate:"."+this.get("host").getClassName("item"),event:"dblclick",loadfrom:function(i){return i.one("a").get("textContent");},submitto:d.bind(function(i){var j=this.get("host").get("recordset").getRecord(i.get("id")),l=j.getValue(),k=this.get("fnGetValue");d.io(d.substitute(e,{value:i.one("input").get("value"),id:k(l,"id")}),{on:{start:function(p,n,m){},success:function(p,n,m){this._placeholder.editable.set("editing",false);this._placeholder.editable.set("saving",false);this._itemSaved(n,m);},failure:function(p,n,m){}},context:this,arguments:{node:i,record:j}});},this)});g.editable.on("save",d.bind(this._itemSaved,this));},_repositionEditingTools:function(){var f=this.get("host").get("contentBox").all("li."+this.get("host").getClassName("item")),e=f.pop();this.get("host").get("contentBox").append(this._phlistitem);},_renderAddControl:function(e){return d.substitute(e.template,e);},_handleRemoveItemClicked:function(f){this.remove(f.target);},_itemSaved:function(m,g){var l=d.JSON.parse(m.responseText),f=this.get("host").get("recordset"),k=g.node.get("id"),e=f.get("records"),j=0,h;for(;j<e.length;j++){if(e[j].get("id")==k){break;}}h=f.getRecord(j);h.set("data",l.record);f.update(h,j);this.get("host").set("recordset",f);},_newItemAdded:function(g){var f=d.JSON.parse(g.details[0].responseText),e=this.get("host").get("recordset");e.add(f);this.get("host").set("recordset",e);this._placeholder.editable.clear();},remove:function(e){},add:function(e){},update:function(f,e){},ITEM_ADD_TEMPLATE:'<li class="{className}" id="{id}"><span class="{wrapperClassName}"></span></li>',_placeholder:null,_phlistitem:null});d.namespace("DP").DatalistEditing=a;},"@VERSION@",{requires:["plugin","substitute","json-parse","gallery-dp-datalist","gallery-dp-editable"]});