<!DOCTYPE html>
<html>
    <head>
        <title>Test for gallery-user-patch-datatable-rollup</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="http://yui.yahooapis.com/3.3.0/build/yui/yui-min.js"
        charset="utf-8"></script>
        <style type="text/css" media="screen">
            .yui3-skin-sam td .yui3-datatable-liner {
                padding-right: 20px;
            }
        </style>
    </head>
    <body class="yui3-skin-sam">
        <h2>Test Patch Rollup</h2>
        <p>Test multiple user patches in one datatable instance</p>
        <p><input type="button" value="Run Tests" id="btnRun" disabled="true"></p>
        <script type="text/javascript">
        (function() {
            YUI({
                //combine: false,
                filter: (window.location.search.match(/[?&]filter=([^&]+)/) || [])[1] || 'min',
                allowRollup: false,
                groups : {
                    userpatch: {
                        combine: false,
                        base : '../../../build',
                        root : '../../../build',
                        modules : {
                            'gallery-user-patch-2529808' : {
                                path: '/gallery-user-patch-2529808/gallery-user-patch-2529808-debug.js'
                            },
                            'gallery-user-patch-2529920-2529921' : {
                                path: '/gallery-user-patch-2529920-2529921/gallery-user-patch-2529920-2529921-debug.js'
                            },
                            'gallery-user-patch-2529943' : {
                                path: '/gallery-user-patch-2529943/gallery-user-patch-2529943-debug.js'
                            },
                            'gallery-user-patch-2529968' : {
                                path: '/gallery-user-patch-2529968/gallery-user-patch-2529968-debug.js'
                            },
                            'gallery-user-patch-2529975' : {
                                path: '/gallery-user-patch-2529975/gallery-user-patch-2529975-debug.js'
                            },
                            'gallery-user-patch-2530026' : {
                                path: '/gallery-user-patch-2530026/gallery-user-patch-2530026-debug.js'
                            }
                        }
                    }
                }
        }).use("console", "test", "dump", "datatable", "css-reset"
            , "gallery-user-patch-2529808"
            , "gallery-user-patch-2529920-2529921"
            , "gallery-user-patch-2529943"
            , "gallery-user-patch-2529968"
            , "gallery-user-patch-2529975"
            , "gallery-user-patch-2530026"
            , function(Y) {

                var BTNRUN = Y.one("#btnRun");
                BTNRUN.set("disabled", false);
                Y.on("click", function(e){
                    Y.Test.Runner.run();
                }, BTNRUN);
                var myConsole = new Y.Console().render();


                var testBasic = new Y.Test.Case({ 
                    name: "Patch Rollup Test",
                    
                    setUp: function() {
                        this.mockresponse = {
                            response: {
                                results: [
                                    { "id" : "100", "name" : "Joe", "last":"Johnson"},
                                    { "id" : "200", "name" : "Mark", "last":"Smith" },
                                    { "id" : "300", "name" : "Andrew", "last":"Newton" }
                                ]
                            }
                        };
                        
                        this.testDataSource = new Y.DataSource.Local({ source: this.mockresponse.response.results });

                        this.testDataTable = new Y.DataTable.Base({
                            columnset : [ { key: "id", sortable: true }, { key: "name", label:"f", sortable: true }
                                , { key: "last", label: "l", sortable: true }],
                            summary : "User patched DataTable Instance",
                            plugins : [
                                { fn: Y.Plugin.DataTableDataSource, cfg: { datasource: this.testDataSource } }
                                , { fn: Y.Plugin.DataTableSort }                                
                                , { fn: Y.Plugin.DataTableScroll, cfg: { height: '200px' } }

                            ]
                        });
                    },
                    
                    tearDown: function() {
                        //this.testDataTable.destroy();
                        delete this.testDataTable;
                    },
                    
                    "test scroll+sort+datasource causes column mismatch" : function() {
                        this.testDataTable.render();
                        this.testDataTable.datasource.load();
                        
                        var dt = this.testDataTable;
                        
                        this.testDataTable.sort.after('lastSortedByChange', function(e) {
                            dt.scroll._syncWidths();
                        }, this);
                    }
                });

                var suite = new Y.Test.Suite({name:"Patch Ticket 2529808 Test Suite"});
                suite.add(testBasic);

                Y.Test.Runner.setName("Test Runner");
                Y.Test.Runner.add(suite);
                Y.Test.Runner.run();
            });
        })();
        </script>
    </body>
</html>
